{% extends "base.html" %}

{% block title %}Lotes - {{ massa.nome }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <div class="text-muted small">VISÃO DETALHADA POR MATERIAL</div>
            <h3 class="fw-bold text-secondary mb-0">{{ massa.nome }}</h3>
            <div class="text-muted small">Cód: {{ massa.cod }} | Total de Lotes: {{ lotes|length }}</div>
        </div>
        <div>
            <a href="{{ url_for('pagina_relatorios') }}" class="btn btn-outline-secondary btn-sm">
                <i class="fas fa-arrow-left me-1"></i> Voltar
            </a>
        </div>
    </div>

    <div class="card mb-3 border-0 shadow-sm bg-light">
        <div class="card-body py-2">
            <form hx-get="{{ url_for('detalhes_lotes_massa', cod_sankhya=massa.cod) }}" 
                  hx-target="#tabela-lotes-body" 
                  hx-trigger="keyup changed delay:500ms, search" 
                  class="row g-2 align-items-center">
                <div class="col-md-4">
                    <div class="input-group input-group-sm">
                        <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span>
                        <input type="search" name="search" class="form-control border-start-0 ps-0" 
                               placeholder="Filtrar por número do lote..." value="{{ search_term }}">
                    </div>
                </div>
                <input type="hidden" name="sort" value="{{ sort_by }}">
                <input type="hidden" name="order" value="{{ order }}">
            </form>
        </div>
    </div>

    <div class="card shadow-sm border-0">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light text-uppercase small text-secondary">
                    <tr>
                        <th>
                            <a href="#" hx-get="{{ url_for('detalhes_lotes_massa', cod_sankhya=massa.cod, sort='lote', order='asc' if order=='desc' else 'desc', search=search_term) }}" 
                               hx-target="#tabela-lotes-body" class="text-decoration-none text-secondary">
                                Lote <i class="fas fa-sort{{ '-down' if sort_by=='lote' and order=='desc' else '-up' if sort_by=='lote' else '' }} ms-1"></i>
                            </a>
                        </th>
                        <th class="text-center">
                            <a href="#" hx-get="{{ url_for('detalhes_lotes_massa', cod_sankhya=massa.cod, sort='data', order='asc' if order=='desc' else 'desc', search=search_term) }}" 
                               hx-target="#tabela-lotes-body" class="text-decoration-none text-secondary">
                                Data <i class="fas fa-sort{{ '-down' if sort_by=='data' and order=='desc' else '-up' if sort_by=='data' else '' }} ms-1"></i>
                            </a>
                        </th>
                        <th class="text-center">
                            <a href="#" hx-get="{{ url_for('detalhes_lotes_massa', cod_sankhya=massa.cod, sort='qtd', order='asc' if order=='desc' else 'desc', search=search_term) }}" 
                               hx-target="#tabela-lotes-body" class="text-decoration-none text-secondary">
                                Qtd <i class="fas fa-sort{{ '-down' if sort_by=='qtd' and order=='desc' else '-up' if sort_by=='qtd' else '' }} ms-1"></i>
                            </a>
                        </th>
                        
                        <th class="text-center text-primary border-start">Média Ts2</th>
                        <th class="text-center text-primary">Média T90</th>
                        <th class="text-center text-primary">Média Visc</th>
                        
                        <th class="text-center">
                            <a href="#" hx-get="{{ url_for('detalhes_lotes_massa', cod_sankhya=massa.cod, sort='score', order='asc' if order=='desc' else 'desc', search=search_term) }}" 
                               hx-target="#tabela-lotes-body" class="text-decoration-none text-secondary">
                                Score <i class="fas fa-sort{{ '-down' if sort_by=='score' and order=='desc' else '-up' if sort_by=='score' else '' }} ms-1"></i>
                            </a>
                        </th>
                        <th class="text-end pe-3">Ação</th>
                    </tr>
                </thead>
                <tbody id="tabela-lotes-body">
                    {% include 'partial_lista_lotes.html' %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}